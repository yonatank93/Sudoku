<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku Solver</title>
    <style>
        /* CSS to make input boxes square */
        input[type="text"] {
            width: 40px;   /* Set width of the input */
            height: 40px;  /* Set height to be the same as width for a square */
            text-align: center; /* Center the text inside the box */
            font-size: 20px; /* Make the font larger for better visibility */
            border: 1px solid #f4f4f4; /* Single border around each input */
            padding: 0; /* Remove extra padding inside the input */
            margin: 0; /* Remove margin to avoid extra space around the input */
            box-sizing: border-box; /* Ensure padding and border are included in the width and height */
        }
        table {
            border-collapse: collapse; /* Collapse borders to avoid double borders */
            border-spacing: 0; /* Remove space between cells */
        }
        td {
            padding: 0; /* Remove extra padding in table cells */
        }
        /* Thicker border for 3x3 box boundaries */
        td:nth-child(3n) {
            border-right: 5px solid black; /* Thicker right border for every 3rd column */
        }
        tr:nth-child(3n) td {
            border-bottom: 5px solid black; /* Thicker bottom border for every 3rd row */
        }
        /* Ensure bottom and right borders are not visible */
        tr:nth-last-child(1) td {
            border-bottom: none
        }
        td:nth-last-child(1) {
            border-right: none
        }
    </style>
    <script>
        // Store difficulty before submitting form
        function storeDifficulty() {
            localStorage.setItem("difficulty", document.getElementById("difficulty").value);
        }

        // Restore difficulty after page reload
        document.addEventListener("DOMContentLoaded", function () {
            const difficultySlider = document.getElementById("difficulty");
            const savedDifficulty = localStorage.getItem("difficulty");

            if (savedDifficulty) {
                difficultySlider.value = savedDifficulty;
                updateDifficultyLabel(savedDifficulty);
            }
        });

        // Modify clearInputs to allow keeping difficulty
        function clearInputs(resetDifficulty = true) {
            document.querySelectorAll('input[type="text"]').forEach(input => input.value = '');

            if (resetDifficulty) {
                document.getElementById("difficulty").value = 3; // Default to Hard
                updateDifficultyLabel(3);
            }
        }

        // Update difficulty label (Easy - Hard)
        function updateDifficultyLabel(value) {
            document.getElementById("difficultyLabel").innerText = value == 1 ? "Easy" : value == 2 ? "Medium" : "Hard";
        }

        document.addEventListener("DOMContentLoaded", function () {
            // Attach event listener to "Generate Problem" button
            document.getElementById("generateBtn").addEventListener("click", function() {
                const level = document.getElementById("difficulty").value;  // Get difficulty from dropdown

                fetch(`/generate?level=${level}`)  // Fetch Sudoku problem from Flask backend
                    .then(response => response.json())
                    .then(data => {
                        const problem = data.problem;
                        for (let i = 0; i < 9; i++) {
                            for (let j = 0; j < 9; j++) {
                                let cell = document.querySelector(`input[name="cell${i}${j}"]`);
                                if (cell) {
                                    cell.value = problem[i][j] > 0 ? problem[i][j] : '';
                                }
                            }
                        }
                    })
                    .catch(error => console.error("Error fetching Sudoku problem:", error));
            });
        });
    </script>
</head>
<body>
    <h1>Sudoku Solver</h1>
    <form method="POST" onsubmit="storeDifficulty()">
        <table border="1">
            {% for i in range(9) %}
            <tr>
                {% for j in range(9) %}
                <td>
                    <input type="text" name="cell{{i}}{{j}}" size="1" maxlength="1" 
                           value="{{ solution[i][j] if solution[i][j] > 0 else '' }}">
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>
        <br>

	<!-- Generate Problem Button -->
	<button type="button" id="generateBtn">Generate Problem</button>
	<!-- Difficulty Slider -->
	<label for="difficulty">Difficulty:</label>
	<span>Easy</span> <!-- Left label -->
	<input type="range" id="difficulty" min="1" max="5" value="3" step="1" oninput="updateDifficultyLabel(this.value)">
	<span>Hard</span> <!-- Right label -->
	<br>

	<!-- Solve Button -->
        <button type="submit">Solve</button>

        <!-- Reset Button (clears the input fields) -->
	<button type="button" onclick="clearInputs(false)">Reset</button>
    </form>
</body>
</html>
